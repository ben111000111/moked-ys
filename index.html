<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>סידור עבודה | מוקד המוקד</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
    <style>body { font-family: 'Assistant', sans-serif; background-color: #f8fafc; } * { font-style: normal !important; }</style>
</head>
<body class="min-h-screen pb-20">
    <script>if(localStorage.getItem('user_auth') !== 'true') window.location.replace('login.html');</script>
    <header class="bg-white border-b-2 p-5 sticky top-0 z-50 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-4"><img id="headerLogo" class="h-14"><h1 id="welcomeMsg" class="text-lg font-black text-slate-800">שלום...</h1></div>
        <nav class="flex gap-2">
            <a href="index.html" class="px-3 py-2 bg-blue-600 text-white rounded-xl font-bold text-xs">בית</a>
            <a href="sabbaths.html" class="px-3 py-2 bg-white border rounded-xl font-bold text-xs text-slate-600">שבתות</a>
            <a href="profile.html" class="px-3 py-2 bg-slate-50 border border-blue-100 rounded-xl font-bold text-xs text-blue-700">פרופיל</a>
        </nav>
    </header>
    <main class="max-w-7xl mx-auto p-8 text-right">
        <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-3xl border shadow-sm">
            <button onclick="changeWeek(-1)" class="w-10 h-10 border rounded-full font-bold">◀</button>
            <div class="text-center"><h2 class="text-2xl font-black text-slate-800">סידור שבועי</h2><div id="parashaBadge" class="text-blue-600 font-extrabold text-sm">טוען...</div></div>
            <button onclick="changeWeek(1)" class="w-10 h-10 border rounded-full font-bold">▶</button>
        </div>
        <div id="mainGrid" class="grid grid-cols-1 md:grid-cols-6 gap-4"></div>
    </main>
    <script src="config.js"></script>
    <script>
        let db = [], anchor = new Date(); document.getElementById('headerLogo').src = CONFIG.LOGO_FILENAME;
        function updateP(d) {
            let s = new Date(d); s.setDate(d.getDate()+(6-d.getDay())); const k = s.toISOString().split('T')[0];
            const n = PARASHOT_DB[k] || "פרשת השבוע"; document.getElementById('parashaBadge').innerText = n.includes("ערב") ? `שבת ${n}` : `שבת פרשת ${n}`;
        }
        async function load() {
            updateP(anchor);
            try { const r = await fetch(CONFIG.SCRIPT_URL); db = await r.json(); render(); } catch(e) {}
        }
        function render() {
            const grid = document.getElementById('mainGrid'), DAYS = ['מוצ"ש','ראשון','שני','שלישי','רביעי','חמישי'];
            let sun = new Date(anchor); sun.setDate(anchor.getDate() - anchor.getDay());
            let html = "";
            for(let i=0; i<6; i++) {
                let d = new Date(sun); d.setDate(sun.getDate() + (i-1)); let k = d.toISOString().split('T')[0];
                html += `<div class="bg-white p-4 rounded-2xl border shadow-sm"><div class="text-center border-b pb-2 mb-3"><div class="font-black text-slate-700">${DAYS[i]}</div><div class="text-[9px] text-blue-500 font-bold">${d.getDate()}/${d.getMonth()+1}</div></div>`;
                html += slot(k, 'morn', 'בוקר'); html += slot(k, 'eve', 'ערב'); html += slot(k, 'night', 'לילה');
                html += `</div>`;
            }
            grid.innerHTML = html;
        }
        function slot(d, s, n) {
            const b = (db.schedule || db).find(x => x.תאריך === d && x.סוג_משמרת === s);
            return `<div class="mb-3"><div class="text-[9px] font-black text-slate-400 uppercase tracking-tighter">${n}</div><button class="w-full py-2 rounded-xl font-bold border ${b?'bg-blue-600 text-white':'text-slate-400'}">${b?b.שם_מוקדן:'+ פנוי'}</button></div>`;
        }
        function changeWeek(d) { anchor.setDate(anchor.getDate()+(7*d)); load(); }
        const u = JSON.parse(localStorage.getItem('user_profile') || '{"name":"מוקדן"}'); document.getElementById('welcomeMsg').innerText = `שלום, ${u.name}`;
        load();
    </script>
</body>
</html>

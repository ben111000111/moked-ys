<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×¡×™×“×•×¨ ×¢×‘×•×“×” | ××•×§×“ ×”××•×§×“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .slot-btn { @apply w-full mb-1.5 py-2.5 rounded-xl font-bold text-[13px] border transition-all shadow-sm; }
        .slot-free { @apply border-slate-200 text-slate-400 hover:bg-emerald-50 hover:text-emerald-600; }
        .slot-taken { @apply bg-blue-600 border-blue-700 text-white font-bold; }
        .card { @apply bg-white p-4 rounded-2xl border border-slate-200 shadow-sm h-full flex flex-col; }
        .nav-btn { @apply px-3 py-2 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all text-slate-600 font-bold text-xs flex items-center gap-1; }
    </style>
</head>
<body class="min-h-screen pb-20">
    <script>if(localStorage.getItem('user_auth') !== 'true') window.location.replace('login.html');</script>

    <header class="bg-white border-b-2 border-slate-200 sticky top-0 z-50 px-6 py-4 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-4 text-right">
            <img id="headerLogo" class="h-14" alt="×œ×•×’×•">
            <div>
                <h1 id="welcomeMsg" class="text-lg font-black text-slate-800 italic leading-none">×©×œ×•×...</h1>
                <p id="timeGreeting" class="text-blue-600 font-bold text-[10px] uppercase mt-1"></p>
            </div>
        </div>
        
        <nav class="flex gap-2">
            <a href="index.html" class="nav-btn bg-blue-600 border-blue-600 text-white">×‘×™×ª</a>
            <a href="sabbaths.html" class="nav-btn">×©×‘×ª×•×ª</a>
            <a href="profile.html" class="nav-btn bg-slate-50 text-blue-700 border-blue-100">ğŸ‘¤ ××–×•×¨ ××™×©×™</a>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto p-4 md:p-8 text-right">
        <div class="flex justify-between items-center mb-8 bg-white p-4 rounded-3xl border shadow-sm">
            <button onclick="changeWeek(-1)" class="w-10 h-10 border rounded-full hover:bg-slate-50 font-bold">â—€</button>
            <div class="text-center">
                <h2 class="text-2xl font-black text-slate-800 uppercase italic tracking-tight">×¡×™×“×•×¨ ×¢×‘×•×“×” ×©×‘×•×¢×™</h2>
                <div id="parashaBadge" class="text-blue-600 font-extrabold text-sm italic">××—×©×‘ ×¤×¨×©×”...</div>
            </div>
            <button onclick="changeWeek(1)" class="w-10 h-10 border rounded-full hover:bg-slate-50 font-bold">â–¶</button>
        </div>

        <div id="mainGrid" class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-8"></div>
        <div id="weekendGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t pt-8 border-slate-200"></div>
    </main>

    <script src="config.js"></script>
    <script>
        // ×”×××’×¨ ×”××œ× ×›×•×œ×œ 2025-2027 (××§×•×¦×¨ ×›××Ÿ ×œ×”××—×©×”, ×ª×©××™×¨ ××¦×œ×š ××ª ×”×¨×©×™××” ×”××œ××” ×©× ×ª×ª×™ ×§×•×“×)
        const PARASHOT_DB = {
            "2025-12-27": "×•×™×’×©", "2026-01-03": "×•×™×—×™", "2026-01-10": "×©××•×ª", 
            "2026-04-04": "×—×•×œ ×”××•×¢×“ ×¤×¡×—", "2026-09-12": "×¢×¨×‘ ×¨××© ×”×©× ×”",
            "2026-09-26": "×¢×¨×‘ ×¡×•×›×•×ª", "2027-04-24": "×—×•×œ ×”××•×¢×“ ×¤×¡×—"
            // ... ×ª×¢×ª×™×§ ×œ×¤×” ××ª ×”×¨×©×™××” ×”××œ××” ×©× ×ª×ª×™ ×‘×ª×’×•×‘×” ×”×§×•×“××ª
        };

        let db = [], anchor = new Date();
        document.getElementById('headerLogo').src = CONFIG.LOGO_FILENAME || 'logo.png';

        function updateParasha(date) {
            let sat = new Date(date);
            sat.setDate(date.getDate() + (6 - date.getDay()));
            const key = sat.toISOString().split('T')[0];
            const name = PARASHOT_DB[key] || "×¤×¨×©×ª ×”×©×‘×•×¢";
            
            // ×œ×•×’×™×§×” ×—×›××”: ×× ×–×” ×—×’, ×œ× ×›×•×ª×‘×™× "×¤×¨×©×ª"
            const isHoliday = name.includes("×—×•×œ ×”××•×¢×“") || name.includes("×¢×¨×‘") || name.includes("×¨××© ×”×©× ×”");
            document.getElementById('parashaBadge').innerText = isHoliday ? `×©×‘×ª ${name}` : `×©×‘×ª ×¤×¨×©×ª ${name}`;
        }

        async function load() {
            updateParasha(anchor);
            try {
                const r = await fetch(CONFIG.SCRIPT_URL);
                db = await r.json();
                render();
            } catch(e) { console.error(e); }
        }

        function render() {
            const grid = document.getElementById('mainGrid');
            let sun = new Date(anchor); sun.setDate(anchor.getDate() - anchor.getDay());
            let satNight = new Date(sun); satNight.setDate(sun.getDate() - 1);

            let mainHtml = "";
            const WEEKDAYS = ['××•×¦"×©', '×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™'];
            for(let i=0; i<6; i++) {
                let d = new Date(satNight); d.setDate(satNight.getDate() + i);
                let dKey = d.toISOString().split('T')[0];
                mainHtml += `<div class="card"><div class="text-center border-b pb-2 mb-3"><div class="font-black text-slate-700 italic">${WEEKDAYS[i]}</div><div class="text-[9px] text-blue-500 font-bold">${d.getDate()}/${d.getMonth()+1}</div></div>`;
                if(WEEKDAYS[i] === '××•×¦"×©') mainHtml += renderSlot(dKey, 'night', '×œ×™×œ×”');
                else {
                    mainHtml += renderSlot(dKey, 'morn', '×‘×•×§×¨', i < 5);
                    mainHtml += renderSlot(dKey, 'eve', '×¢×¨×‘');
                    mainHtml += renderSlot(dKey, 'night', '×œ×™×œ×”');
                }
                mainHtml += `</div>`;
            }
            grid.innerHTML = mainHtml;
            renderWeekend(sun);
        }

        function renderWeekend(sun) {
            let fri = new Date(sun); fri.setDate(sun.getDate() + 5);
            let friKey = fri.toISOString().split('T')[0];
            document.getElementById('weekendGrid').innerHTML = `
                <div class="card bg-emerald-50/20 border-emerald-100">
                    <div class="text-center border-b border-emerald-100 pb-2 mb-3 font-black text-emerald-800 text-xs italic">×™×•× ×©×™×©×™ (8:00-12:00)</div>
                    ${renderSlot(friKey, 'fri_morn', '×‘×•×§×¨ ×©×™×©×™', false, true)}
                </div>
                <div class="card bg-blue-50/20 border-blue-100">
                    <div class="text-center border-b border-blue-100 pb-2 mb-3 font-black text-blue-800 text-xs italic">×©×‘×ª ×§×•×“×©</div>
                    <div class="grid grid-cols-2 gap-2">${renderSlot(friKey, 'sat_morn', '×‘×•×§×¨ ×©×‘×ª')}${renderSlot(friKey, 'sat_night', '×œ×™×œ×” ×©×‘×ª')}</div>
                </div>`;
        }

        function renderSlot(date, sid, sname, isMorn, isGirls) {
            const b = db.find(x => x.×ª××¨×™×š === date && x.×¡×•×’_××©××¨×ª === sid);
            let html = `<div class="mb-3"><div class="text-[9px] font-black text-slate-400 uppercase tracking-tighter">${sname}</div>`;
            if(isGirls) html += `<div class="bg-pink-100 text-pink-600 text-[8px] py-0.5 text-center font-bold rounded-md mb-1 italic">×‘× ×•×ª ×‘×œ×‘×“</div>`;
            if(b) html += `<button class="slot-btn slot-taken" title="${b.×˜×œ×¤×•×Ÿ}">${b.×©×_××•×§×“×Ÿ}</button>`;
            else html += `<button class="slot-btn slot-free">+ ×¤× ×•×™</button>`;
            return html + `</div>`;
        }

        function changeWeek(d) { anchor.setDate(anchor.getDate() + (7*d)); load(); }
        
        const profile = JSON.parse(localStorage.getItem('user_profile') || '{"name":"××•×§×“×Ÿ"}');
        document.getElementById('welcomeMsg').innerText = `×©×œ×•×, ${profile.name}`;
        
        load();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>砖转转 拽 | 拽  砖专</title>
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 font-['Assistant'] pb-20">
    <script>if(localStorage.getItem('user_auth') !== 'true') window.location.replace('login.html');</script>

    <header class="bg-white border-b-2 border-slate-200 p-4 sticky top-0 z-50 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-4">
            <img src="logo.png" class="h-12" onerror="this.src='https://via.placeholder.com/50?text=Logo'">
            <h1 class="text-xl font-black text-slate-800">砖转转 拽专转</h1>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleView()" class="p-2 bg-slate-100 rounded-xl text-slate-600"><svg id="viewIcon" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
            <a href="index.html" class="p-2 bg-blue-100 rounded-xl text-blue-600"></a>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-6 text-right">
        <input type="text" id="searchInput" onkeyup="filterSabbaths()" placeholder="驻砖 驻专砖  砖..." class="w-full p-4 mb-8 rounded-2xl border-2 outline-none focus:border-blue-500 font-bold shadow-sm">
        <div id="sabbathContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="col-span-full text-center py-20 font-bold opacity-30 animate-pulse text-xl">注 转 ...</div>
        </div>
    </main>

    <div id="quickModal" class="fixed inset-0 z-[100] hidden bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 shadow-2xl text-right">
            <h3 id="quickParasha" class="text-2xl font-black text-slate-800 mb-4 border-b pb-2 italic"></h3>
            <div id="quickContent" class="space-y-4 text-lg"></div>
            <button onclick="closeQuick()" class="mt-6 w-full py-3 bg-blue-600 text-white font-black rounded-xl">住专</button>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        let db = [];
        let isGridView = true;

        async function init() {
            const container = document.getElementById('sabbathContainer');
            try {
                const res = await fetch(CONFIG.SCRIPT_URL);
                if (!res.ok) throw new Error();
                db = await res.json();
                renderSabbaths();
            } catch(e) {
                container.innerHTML = `<div class="col-span-full text-center p-10 bg-red-50 text-red-600 rounded-2xl font-bold border border-red-100">
                    砖 专  砖住.  砖拽砖专 -config.js 注 砖爪注转 Deploy -Anyone.
                </div>`;
            }
        }

        async function renderSabbaths() {
            const container = document.getElementById('sabbathContainer');
            container.innerHTML = "";
            let sat = new Date(); 
            sat.setDate(sat.getDate() + (6 - sat.getDay()));

            for(let i=0; i<12; i++) {
                let d = new Date(sat); d.setDate(sat.getDate() + (i*7));
                let dKey = d.toISOString().split('T')[0];
                let friKey = new Date(d); friKey.setDate(d.getDate() - 1);
                let friKeyStr = friKey.toISOString().split('T')[0];

                // 住 爪 驻专砖 -API 砖 Hebcal
                const hRes = await fetch(`https://www.hebcal.com/converter?cfg=json&gy=${d.getFullYear()}&gm=${d.getMonth()+1}&gd=${d.getDate()}&g2h=1`);
                const hData = await hRes.json();
                
                // 爪专转 专住
                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-[2rem] border-2 border-slate-100 shadow-sm hover:border-blue-500 transition-all cursor-pointer";
                card.innerHTML = `
                    <div onclick="window.location.href='index.html?jump=${dKey}'">
                        <div class="text-xl font-black text-slate-800">砖转 ${hData.hebrew.split(' ').pop()}</div>
                        <div class="text-blue-600 font-bold text-sm mb-4">${hData.hebrew}</div>
                    </div>
                    <button onclick="showQuick('${hData.hebrew}', '${friKeyStr}')" class="w-full py-2 bg-slate-50 text-blue-600 rounded-xl font-bold text-sm border hover:bg-blue-600 hover:text-white transition-all"> 砖抓? </button>
                `;
                container.appendChild(card);
            }
        }

        function showQuick(hebrew, friDate) {
            document.getElementById('quickParasha').innerText = hebrew;
            const morn = db.filter(x => x.转专 === friDate && x.住_砖专转 === 'sat_morn');
            const night = db.filter(x => x.转专 === friDate && x.住_砖专转 === 'sat_night');

            document.getElementById('quickContent').innerHTML = `
                <div><b class="text-blue-600 block text-sm mb-1">拽专:</b> ${morn.length ? morn.map(w => w.砖_拽).join(', ') : '专 砖抓'}</div>
                <div class="mt-4"><b class="text-blue-600 block text-sm mb-1">:</b> ${night.length ? night.map(w => w.砖_拽).join(', ') : '专 砖抓'}</div>
            `;
            document.getElementById('quickModal').classList.remove('hidden');
        }

        function closeQuick() { document.getElementById('quickModal').classList.add('hidden'); }
        function toggleView() { isGridView = !isGridView; document.getElementById('sabbathContainer').className = isGridView ? "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" : "flex flex-col gap-4"; }
        
        init();
    </script>
</body>
</html>

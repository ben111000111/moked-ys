<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>שיבוץ יומי | מוקד יד שרה</title>
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;800&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 font-['Assistant'] pb-20">
    <header class="bg-white border-b-2 p-4 sticky top-0 z-50 flex justify-between items-center">
        <div class="flex items-center gap-4"><img src="logo.png" class="h-12"><h1 class="text-xl font-black">תצוגה יומית</h1></div>
        <a href="index.html" class="p-3 bg-slate-100 rounded-full hover:bg-blue-100 transition-all"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg></a>
    </header>
    <main class="max-w-2xl mx-auto p-6 text-right">
        <div class="flex justify-between items-center mb-10 bg-white p-6 rounded-3xl border shadow-sm">
            <button onclick="changeDay(-1)" class="w-12 h-12 border rounded-full">◀</button>
            <div class="text-center"><h2 id="periodTitle" class="text-3xl font-black"></h2><div id="hebDate" class="text-blue-600 font-bold"></div></div>
            <button onclick="changeDay(1)" class="w-12 h-12 border rounded-full">▶</button>
        </div>
        <div id="mainGrid" class="space-y-4"></div>
    </main>
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyvsxblLid--zFr8ehMQcXnavcyiFlvaXA5s4yfqfADsyWJGYoQAR2u1GUfPafEw7pR/exec";
        let db = [], anchor = new Date();
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('date')) anchor = new Date(urlParams.get('date'));
        async function load() { const r = await fetch(SCRIPT_URL); db = await r.json(); render(); }
        async function render() {
            const grid = document.getElementById('mainGrid');
            const dKey = anchor.toISOString().split('T')[0];
            const res = await fetch(`https://www.hebcal.com/converter?cfg=json&gy=${anchor.getFullYear()}&gm=${anchor.getMonth()+1}&gd=${anchor.getDate()}&g2h=1`);
            const hData = await res.json();
            document.getElementById('periodTitle').innerText = anchor.toLocaleDateString('he-IL', {weekday:'long', day:'numeric', month:'numeric'});
            document.getElementById('hebDate').innerText = hData.hebrew;
            let shifts = anchor.getDay() === 6 ? [{id:'sat_morn', n:'שבת בוקר'}, {id:'sat_night', n:'שבת לילה'}] : anchor.getDay() === 5 ? [{id:'fri_morn', n:'שישי בוקר'}] : [{id:'morn', n:'בוקר'}, {id:'eve', n:'ערב'}, {id:'night', n:'לילה'}];
            grid.innerHTML = shifts.map(s => {
                const b = db.find(x => x.תאריך === dKey && x.סוג_משמרת === s.id);
                return `<div class="bg-white p-8 rounded-[2rem] border shadow-sm"><h3 class="text-2xl font-black mb-4 text-blue-800">${s.n}</h3>${b ? `<button class="w-full py-4 rounded-2xl bg-blue-600 text-white font-black">${b.שם_מוקדן}</button>` : `<button class="w-full py-4 rounded-2xl border-2 border-dashed border-slate-200 text-slate-400 font-bold">+ פנוי</button>`}</div>`;
            }).join('');
        }
        function changeDay(d) { anchor.setDate(anchor.getDate() + d); render(); }
        load();
    </script>
</body>
</html>
